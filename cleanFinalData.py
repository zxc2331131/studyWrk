# -*- coding: utf-8 -*-
# 將最終資料夾有標記輪廓的圖片 取最大距離 統整為excel資料 並畫線存入 p_final_result
# cleanFinalData.py
"""
Created on Fri Sep 22 13:56:22 2023

@author: zihong
"""

import cv2
import numpy as np
import os
import cv2
import glob
import pandas as pd


#讀取模型與訓練權重
def initNet():
    # CONFIG = './train_finished_1/yolov4-tiny-myobj.cfg'
    CONFIG = 'D:/Yolo_v4/darknet/build/darknet/x64/cfg/yolov4-koi.cfg'
    # WEIGHT = './yolov4-tiny-myobj_last.weights'
    WEIGHT = 'D:/Yolo_v4/darknet/build/darknet/x64/backup/yolov4-koi_last.weights'
    # WEIGHT = './train_finished/yolov4-tiny-myobj_last.weights'
    net = cv2.dnn.readNet(CONFIG, WEIGHT)
    model = cv2.dnn_DetectionModel(net)
    model.setInputParams(size=(416, 416), scale=1/255.0)
    model.setInputSwapRB(True)
    return model

#物件偵測
def nnProcess(image, model):
    classes, confs, boxes = model.detect(image, 0.4, 0.1)
    return classes, confs, boxes

def do_pic_otsu(result_path, chk_path, folder_typ):
    # 先宣告folder_typ對應中文名稱
    typ_list = {
        "Predict_G_Pic_Cross": "高斯十字",
        "Predict_G_Pic_Cross_acc": "高斯十字正確率",
        "Predict_G_Pic_Cross2": "高斯十字2",
        "Predict_G_Pic_Cross2_acc": "高斯十字2正確率",
        "Predict_G_Pic_Gray": "高斯灰階",
        "Predict_G_Pic_Gray_acc": "高斯灰階正確率",
        "Predict_G_Pic_Gray2": "高斯灰階2",
        "Predict_G_Pic_Gray2_acc": "高斯灰階2正確率",
        "Predict_G_Pic_Plus": "高斯global",
        "Predict_G_Pic_Plus_acc": "高斯global正確率",
        "Predict_G_Pic_Plus2": "高斯global2",
        "Predict_G_Pic_Plus2_acc": "高斯global2正確率",
        "Predict_Pic_Cross": "十字",
        "Predict_Pic_Cross_acc": "十字正確率",
        "Predict_Pic_Cross2": "十字2",
        "Predict_Pic_Cross2_acc": "十字2正確率",
        "Predict_Pic_Gray": "灰階",
        "Predict_Pic_Gray_acc": "灰階正確率",
        "Predict_Pic_Gray2": "灰階2",
        "Predict_Pic_Gray2_acc": "灰階2正確率",
        "Predict_Pic_Plus": "global",
        "Predict_Pic_Plus_acc": "global正確率",
        "Predict_Pic_Plus2": "global2",
        "Predict_Pic_Plus2_acc": "global2正確率",
        }
    # 動態新增欄位  如果沒有這個欄位的話 先宣告
    if folder_typ not in new_df.columns:
        # new_df[typ_list[folder_typ]] = None
        new_df[folder_typ] = None
    if folder_typ + '_acc' not in new_df.columns:
        # new_df[typ_list[folder_typ+'_acc']] = None
        new_df[folder_typ+'_acc'] = None
    # 指定取出yolo-v4 jpg圖片路徑
    predict_source = 'D:/KC_AOI_Project/wrk/study_wrk/compare_Pic/'
    # 读取图像
    # result_path = 'D:/KC_AOI_Project/wrk/study_wrk/predict_result/Predict_Pic_Cross/'
    # 取出路徑下所有圖片 並存成list
    files = os.listdir(predict_source)
    print('※ 資料夾共有 {} 張圖檔'.format(len(files)))
    print('※ 開始執行otsu處理...')
    
    number = 1
    for file in files:
        print(' ▼ 第{}張'.format(number))
        print(' ▼ 檔名: {}'.format(file))
        voc_no = file.split('_')
        print(' ▼ 檔名1: {}'.format(result_path+file))
        
        result_image = cv2.imread(result_path+str(voc_no[0])+ '.bmp')
        print(result_path+str(voc_no[0])+ '.bmp','test')
        number = number + 1 
        img = cv2.imdecode(np.fromfile(predict_source + file, dtype=np.uint8), -1)
        classes, confs, boxes = nnProcess(img, model)
        
        image = get_target(result_image, classes, confs, boxes,file)
        # 定义红色的颜色范围
        lower_red = np.array([0, 0, 200])
        upper_red = np.array([100, 100, 255])

        # 创建红色掩码
        red_mask = cv2.inRange(image, lower_red, upper_red)

        # 查找红色点的坐标
        red_points = cv2.findNonZero(red_mask)
        # print(image.shape,'test')
        # cv2.imshow('Image', image) 
        # cv2.waitKey(0)
        # cv2.destroyAllWindows()
        if red_points is None:
            # 目標區塊內 unet沒有判斷出輪廓 所以沒有紅點
            print('73====>none')
            # new_df[typ_list[folder_typ]][int(voc_no[0])-1] = 0
            # new_df[typ_list[folder_typ+'_acc']][int(voc_no[0])-1] = 0
            # # 如果預測不到木 全部以0計
            # new_df[folder_typ][int(voc_no[0])-1] = 0
            # new_df[folder_typ+'_acc'][int(voc_no[0])-1] = 0
            # 如果預測不到目標  最大誤差值應該以原圖長度計 誤差率為100%
            new_df[folder_typ][int(voc_no[0])-1] = new_df['RealSize'][int(voc_no[0])-1]
            new_df[folder_typ+'_acc'][int(voc_no[0])-1] = 1
        else:
            # 目標區塊內 unet有判斷出輪廓
            # 计算点之间的距离
            max_distance = 0
            max_distance_points = None
            for i in range(len(red_points)):
                for j in range(i + 1, len(red_points)):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                    distance = np.linalg.norm(red_points[i] - red_points[j])
                    if distance > max_distance:
                        max_distance = distance
                        max_distance_points = (red_points[i][0], red_points[j][0])
    
            # 在图像上绘制最大距离的线
            if max_distance_points is not None:
                cv2.line(result_image, max_distance_points[0], max_distance_points[1], (0, 0, 255), 2)
    
            print("最大距离：", max_distance)
            # (RealSize/Length算出每個pixel長度 再*max_distance) 再- RealSize 取絕對值 ===> 預測與實際相差的長度
            # new_df[typ_list[folder_typ]][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1])- new_df['RealSize'][int(voc_no[0])-1])
            # new_df[typ_list[folder_typ+'_acc']][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1])-(new_df['RealSize'][int(voc_no[0])-1]))/new_df['RealSize'][int(voc_no[0])-1]
            # 調整為 abs(預測 - 原圖) / max (預測,原圖)
            # new_df[folder_typ][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1])- new_df['RealSize'][int(voc_no[0])-1])
            new_df[folder_typ][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1]))
            new_df[folder_typ+'_acc'][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1])-(new_df['RealSize'][int(voc_no[0])-1]))/new_df['RealSize'][int(voc_no[0])-1]
            # new_df[folder_typ+'_acc'][int(voc_no[0])-1] = abs(max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1])-(new_df['RealSize'][int(voc_no[0])-1]))/max(new_df['RealSize'][int(voc_no[0])-1], max_distance*(new_df['RealSize'][int(voc_no[0])-1]/new_df['Length'][int(voc_no[0])-1]))
        cv2.imwrite(chk_path+file, result_image)
 # 裁減圖片
def get_target(image, classes, confs, boxes, file):
     # 取得圖片資訊
     imgInfo = image.shape
     height = imgInfo[0]
     width = imgInfo[1]
     # 處理圖像時,資料類別都np.uint8
     print(imgInfo)
     # 大圖
     result = np.zeros((height,width,3),np.uint8)
     # 計算classid == 0 處理次數,如果>0則不要重製處理後的影像陣列
     do_count = 0
     # 先判斷classes裡面有沒有0的target 沒有的話考慮有可能被判斷成類別的尺標所以做例外處理
     has_zero = np.any(classes == 0)
     print('has_zero',has_zero)
     for (classid, conf, box) in zip(classes, confs, boxes):
         print('classes',classes)
         print('classid',classid)
         print('conf',conf)
         print('box',box)
         print('imgInfo',imgInfo)
         x, y, w, h = box
         print('------------------------')
         if (classid == 0):
             # 各區塊處理
             result1 = np.zeros((h,w,3),np.uint8)
             for i in range(y,y+h):
                 for j in range(x,x+w):
                     result1[i-y,j-x] = image[i,j]
             boxInfo = result1.shape     
             box_h = boxInfo[0]
             box_W = boxInfo[1]
             # 如果>0則不要重製處理後的影像陣列, ==0 為第一次處理target 宣告有底色的處理後資料陣列
             if do_count == 1:
                 result = np.full((height, width, 3), 0, np.uint8)
             for i in range(0,box_h):
                 for j in range(0,box_W):
                     result[i+y,j+x] = result1[i,j]
         # classes裡面有沒有0的target 沒有的話考慮有可能被判斷成類別的尺標所以做例外處理
         if (has_zero == False):
             print(8888)
             if (classid == 1):
                 # 計算classid == 0 處理次數
                 do_count += 1
                 # 各區塊處理
                 result1 = np.zeros((h,w,3),np.uint8)
                 for i in range(y,y+h):
                     for j in range(x,x+w):
                         result1[i-y,j-x] = image[i,j]
                 boxInfo = result1.shape     
                 box_h = boxInfo[0]
                 box_W = boxInfo[1]
                 # 如果>1則不要重製處理後的影像陣列, ==1 為第一次處理target 宣告有底色的處理後資料陣列
                 if do_count == 1:
                     # 宣告底色為255的 result 圖片陣列
                     result = np.full((height, width, 3), 0, np.uint8)
                 for i in range(0,box_h):
                     for j in range(0,box_W):
                         result[i+y,j+x] = result1[i,j]
     return result  
# # 取出KC2,KC3  excel表格內 Defact Name 爛位值, 輸出array
def readCSV():
    global new_df
    # 从Excel文件中读取所有数据
    df_A = pd.read_excel('KC_EXCEL/KC2.xlsx', header=1)
    df_B = pd.read_excel('KC_EXCEL/KC3.xlsx', header=1)
    
    # 创建一个新的DataFrame，交替合并数据
    new_df = pd.DataFrame()
    new_df = pd.concat([new_df, df_A, df_B], axis=0, ignore_index=True)
    
    # 选择并保留你需要的列
    columns_to_keep = ['Kind', 'Side', 'Judge', 'Size', 'Pos-X', 'Pos-Y', 'RealSize', 'Area', 'Defect Name', 'Length', '비율']
    new_df = new_df[columns_to_keep]
    # 加一欄ID
    new_df['ID'] = new_df.reset_index(drop=True).index + 1
    # 将ID列移到DataFrame的第一列
    new_df = new_df[['ID'] + columns_to_keep]
    return 


# 新的DataFrame来存個方法及交叉驗證的 結果
new_df = pd.DataFrame()
readCSV()
# 讀取圖像
result_folder = 'D:/KC_AOI_Project/wrk/study_wrk/predict_result/'
final_folder = 'D:/KC_AOI_Project/wrk/study_wrk/p_final_result/'
# 宣告 訓練好的YOLOv4 模型
model = initNet()
# 使用os.walk()遞迴獲取所有子資料夾
for root, dirs, files in os.walk(result_folder):
    for folder in dirs:
        folder_path = os.path.join(root, folder)
        print("子資料夾:", folder_path)
        print("子資料夾2:", folder)
        # 檢查是否存在名稱為"AAA"的資料夾
        chk_path = os.path.join(final_folder, folder)
        print("子資料夾3:", chk_path)
        
        if not os.path.exists(chk_path):
            # 如果不存在，則創建它
            os.makedirs(chk_path)
            print("已創建名稱為'"+folder+"'的資料夾。")
        else:
            print("名稱為'"+folder+"'的資料夾已存在。")
        # 資料夾批次處理
        do_pic_otsu(folder_path+'/', chk_path+'/',folder)
# 将新的DataFrame导出到Excel文件
new_df.to_excel('final_acc_file.xlsx', index=False) 


# 指定單張檢查確認
image = cv2.imread('D:/KC_AOI_Project/wrk/study_wrk/predict_result/Predict_G_Pic_Cross/21.bmp')



# # 定义红色的颜色范围
# lower_red = np.array([0, 0, 200])
# upper_red = np.array([100, 100, 255])

# # 创建红色掩码
# red_mask = cv2.inRange(image, lower_red, upper_red)

# # 查找红色点的坐标
# red_points = cv2.findNonZero(red_mask)

# # 计算点之间的距离
# max_distance = 0
# max_distance_points = None
# for i in range(len(red_points)):
#     for j in range(i + 1, len(red_points)):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
#         distance = np.linalg.norm(red_points[i] - red_points[j])
#         if distance > max_distance:
#             max_distance = distance
#             max_distance_points = (red_points[i][0], red_points[j][0])

# # 在图像上绘制最大距离的线
# if max_distance_points is not None:
#     cv2.line(image, max_distance_points[0], max_distance_points[1], (0, 0, 255), 2)

# print("最大距离：", max_distance)

# # 显示图像以及红色点
# cv2.imshow('Image', image)
# cv2.imshow('Red Points', red_mask) 
# cv2.imshow('Image with Max Distance Line', image)
# cv2.waitKey(0)
# cv2.destroyAllWindows




